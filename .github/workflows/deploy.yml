name: Publish package to the Maven Repository
on:
  push:
    branches: [ master ]
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: use yq docker image
        uses: mikefarah/yq@3.3
      - name: add luckperms password database
        run: yq w -i src/main/resources/template.yml spec.values.luckperms.data.password ${{ secrets.LUCKPERMS_DB_PASSWORD }}
      - name: Set up Maven
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: maven-settings-xml-action
        uses: whelk-io/maven-settings-xml-action@v9
        with:
          repositories: '[{ "id": "bolt-rip-public", "url": "https://repo.repsy.io/mvn/boltrip/public", "releases": { "enabled": "true" }, "snapshots": { "enabled": "true" } }]'
          servers: '[{ "id": "bolt-rip-public", "username": "${{ secrets.MAVEN_USERNAME }}", "password": "${{ secrets.MAVEN_PASSWORD }}" }]'
      - name: Publish package
        run: mvn -B deploy
      - name: trigger docker image building
        run: |
            curl -H "Authorization: token "${{ secrets.PERSONAL_ACCESS_TOKEN }}"" \
              --request POST \
              --data '{"event_type": "build"}' \
              https://api.github.com/repos/bolt-rip/config-bungee/dispatches
